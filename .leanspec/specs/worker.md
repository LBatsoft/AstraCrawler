# 爬虫工作节点 (Worker) 规范

## 1. 核心功能

### 1.1 页面爬取
- **场景**: 接收到爬取任务
- **行为**: 启动 Playwright 浏览器，导航到目标 URL，等待页面加载。
- **验证**:
  - 成功返回 HTML 内容。
  - 状态码正确 (200)。
  - 包含页面 Title 和 URL。

### 1.2 反爬虫机制
- **场景**: 访问受保护的目标网站
- **行为**:
  - 加载自定义 Chromium 内核 (如配置)。
  - 注入 CDP 指纹 (User-Agent, WebGL, Canvas)。
  - 启用 `playwright-stealth`。
  - 禁用 `AutomationControlled` 特征。
- **验证**:
  - `navigator.webdriver` 为 `undefined`。
  - User-Agent 与配置一致。

### 1.3 Hook 数据提取
- **场景**: 页面加载完成，且注入了 Hook 脚本
- **行为**: 自动从浏览器上下文中提取 `window._hook_data` (或自定义变量)。
- **验证**:
  - 结果字典中包含 `hook_data` 字段。
  - `hook_data` 内容与页面实际拦截数据一致。

## 2. 异常处理

### 2.1 网络超时
- **场景**: 目标网站响应超时
- **行为**: 捕获异常，重试 (根据配置次数)，最终返回失败结果。

### 2.2 速率限制
- **场景**: 触发本地限流
- **行为**: 阻塞等待，直到获得令牌，再发起请求。

